# Data Model: Message Persistence

## Database Schema (SQLite)

### Table: `messages`

Existing table structure will be enhanced with new columns.

| Column | Type | Nullable | Description |
|--------|------|----------|-------------|
| `id` | INTEGER | No | PK, Auto-increment |
| `session_id` | TEXT | No | Session identifier |
| `type` | TEXT | No | Message type (`human`, `ai`, `system`, `tool`) |
| `content` | TEXT | No | The message payload (JSON for complex types) |
| `created_at` | INTEGER | No | Timestamp (Epoch ms) |
| `input_tokens` | INTEGER | Yes | Tokens sent to the model (New) |
| `output_tokens` | INTEGER | Yes | Tokens generated by the model (New) |
| `total_tokens` | INTEGER | Yes | Total tokens consumed (New) |
| `cache_read_tokens` | INTEGER | Yes | Tokens read from cache (New) |

## TypeScript Interfaces

### UsageMetadata
```typescript
export interface UsageMetadata {
  input_tokens: number;
  output_tokens: number;
  total_tokens: number;
  input_token_details?: {
    cache_read?: number;
  };
}
```

### Extended Message Options
We will likely need to extend how we pass messages to `addMessage` to include these if they aren't on the `BaseMessage` object itself (though LangChain puts them in `response_metadata` or `usage_metadata`).
